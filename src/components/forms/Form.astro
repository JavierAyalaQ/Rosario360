---
import SectionContainer from "@components/wrappers/SectionContainer.astro";
---

<SectionContainer marginY="my-20">
    <form 
        id="contactForm" 
        method="post" 
        action="/send.php" 
        novalidate 
        class="w-full flex flex-col gap-2"
        onsubmit="return validateForm(event)">
        
        <!-- Nombre -->
        <input
            id="name"
            type="text"
            class="border border-gray-300 bg-transparent p-3 w-full rounded outline-none focus:ring ring-green-500/40"
            placeholder="Nombre"
            required
            data-validation-required-message="Nombre..."
        />
        <!-- Email -->
        <input
            id="email"
            type="email"
            class="border border-gray-300 bg-transparent p-3 w-full rounded outline-none focus:ring ring-green-500/40"
            placeholder="Email"
            required
            data-validation-required-message="Correo electrónico..."
        />
        <!-- Asunto -->
        <input
            id="subject"
            type="text"
            class="border border-gray-300 bg-transparent p-3 w-full rounded outline-none focus:ring ring-green-500/40"
            placeholder="Asunto"
            required
            data-validation-required-message="Asunto..."
        />
        <!-- Mensaje -->
        <textarea
            id="message"
            class="border border-gray-300 bg-transparent p-3 w-full rounded outline-none focus:ring ring-green-500/40 max-h-[200px] overflow-y-scroll"
            maxlength="400"
            rows="5"
            placeholder="Mensaje"
            required
            data-validation-required-message="Mensaje..."
        ></textarea>

        <!-- Botón de Enviar -->
        <div>
            <button
                class="bg-green-500 hover:bg-green-600 transition text-green-950 text-md font-semibold rounded py-4 px-12"
                type="submit"
                id="submit">Enviar Mensaje</button>
        </div>
    </form>

    <!-- Popup -->
    <div 
        id="popup" 
        class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rounded-lg bg-white p-4 shadow-2xl z-50">
        <p id="popup-message"></p>
        <button 
            onclick="closePopup()" 
            class="mt-2 bg-gray-200 hover:bg-gray-300 rounded py-2 px-4">Cerrar</button>
    </div>
</SectionContainer>

<script is:inline>
document.addEventListener("DOMContentLoaded", () => {
    // Validación básica en el cliente
    function validateForm(event) {
        event.preventDefault();

        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const subject = document.getElementById("subject").value.trim();
        const message = document.getElementById("message").value.trim();
        const popup = document.getElementById("popup");
        const popupMessage = document.getElementById("popup-message");

        if (!name || !email || !subject || !message) {
            popupMessage.textContent = "Todos los campos son obligatorios.";
            popup.classList.remove("hidden");
            return false;
        }

        // Enviar el formulario si pasa validación
        const form = document.getElementById("contactForm");
        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
        })
            .then((response) => response.json())
            .then((data) => {
                popupMessage.textContent = data.success
                    ? "Mensaje enviado correctamente."
                    : "Error: " + data.message;
                popup.classList.remove("hidden");

                if (data.success) {
                    form.reset(); // Limpiar el formulario si se envió correctamente
                }
            })
            .catch(() => {
                popupMessage.textContent = "Error al enviar el mensaje. Intenta nuevamente.";
                popup.classList.remove("hidden");
            });

        return false; // Prevenir el envío estándar del formulario
    }

    // Función para cerrar el popup
    window.closePopup = () => {
        const popup = document.getElementById("popup");
        popup.classList.add("hidden");
    };
});
</script>
